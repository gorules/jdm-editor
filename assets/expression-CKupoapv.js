import{j as r}from"./index-CQHSiloJ.js";import{a as O,b as y,p as v,u as L,d as F,D as z,f as $,g as H,C as J,R as K,H as U,h as W}from"./confirm-action-C-ZPzkj0.js";import{r as d,R as k}from"./index-DQDNmYQF.js";import{T as w,i as R,e as G}from"./wasm-CV8Fw14A.js";import{c as Q,b as D,a as X}from"./ce-preview-D4sMzfhR.js";import{B as Y}from"./AntdIcon-BaFxb7gP.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],ee=Q("grip-vertical",Z),b=k.createContext({}),q=(e={})=>({id:crypto.randomUUID(),key:"",value:"",...e}),E=({children:e})=>{const a=d.useMemo(()=>O(n=>({configurable:!0,disabled:!1,addRowAbove:(i=0)=>{n(v(s=>(s.expressions.splice(i,0,q()),s)))},addRowBelow:i=>{n(v(s=>(i=i??s.expressions.length-1,s.expressions.splice(i+1,0,q()),s)))},expressions:[],setExpressions:i=>{n({expressions:i})},swapRows:(i,s)=>{n(v(t=>{const[u]=t.expressions.splice(i,1);return t.expressions.splice(s,0,u),t}))},removeRow:i=>{n(v(s=>(s.expressions.splice(i,1),s)))},updateRow:(i,s)=>{n(v(t=>(t.expressions[i]={...t.expressions[i],...s},t)))}})),[]);return r.jsx(b.Provider,{value:a,children:e})};function x(e,a=y){return k.useContext(b)(e,a)}const T=()=>k.useContext(b);E.__docgenInfo={description:"",methods:[],displayName:"ExpressionStoreProvider"};const re=({value:e,onChange:a,defaultValue:n=[],configurable:i=!0,disabled:s=!1})=>{const t=d.useRef(!1),u=T(),{setExpressions:o,expressions:p}=x(({setExpressions:c,expressions:m})=>({setExpressions:c,expressions:m}));return d.useEffect(()=>{u.setState({configurable:i,disabled:s})},[i,s]),d.useEffect(()=>{if(a)return u.subscribe((c,m)=>{y(c.expressions,m.expressions)||a?.(c.expressions)})},[u,a]),d.useEffect(()=>{t.current&&e&&!y(e,p)&&o(e)},[e]),d.useEffect(()=>{e?o(e):n&&o(n),t.current=!0},[]),null},I=({expression:e,index:a,variableType:n})=>{const[i,s]=d.useState(!1),t=d.useRef(null),{updateRow:u,removeRow:o,swapRows:p,disabled:c,configurable:m}=x(({updateRow:l,removeRow:f,swapRows:_,disabled:P,configurable:A})=>({updateRow:l,removeRow:f,swapRows:_,disabled:P,configurable:A})),g=l=>{u(a,l)},N=()=>{o(a)},[{isDropping:h,direction:j},M]=L({accept:"row",collect:l=>({isDropping:l.isOver({shallow:!0}),direction:(l.getDifferenceFromInitialOffset()?.y||0)>0?"down":"up"}),drop:l=>{p(l.index,a)}}),[{isDragging:V},C,B]=F({canDrag:m&&!c,item:()=>({...e,index:a}),type:"row",collect:l=>({isDragging:l.isDragging()})});return B(M(t)),r.jsxs("div",{ref:t,className:D("expression-list-item","expression-list__item",h&&j==="down"&&"dropping-down",h&&j==="up"&&"dropping-up",e?._diff?.status&&`expression-list__item--${e?._diff?.status}`),style:{opacity:V?.5:1},children:[r.jsx("div",{ref:C,className:"expression-list-item__drag","aria-disabled":!m||c,children:r.jsx("div",{className:"expression-list-item__drag__inner",children:e?._diff?.status?r.jsx(z,{status:e?._diff?.status,style:{fontSize:16}}):r.jsx(ee,{size:10})})}),r.jsx("div",{className:"expression-list-item__key",onClick:l=>{const f=l.currentTarget.querySelector("input");if(!f)return;f.focus();const _=f.value.length;f.setSelectionRange(_,_)},children:r.jsx($,{placeholder:"Key",variant:"borderless",readOnly:!m||c,displayDiff:e?._diff?.fields?.key?.status==="modified",previousValue:e?._diff?.fields?.key?.previousValue,value:e?.key,onChange:l=>g({key:l.target.value}),autoComplete:"off"})}),r.jsxs("div",{className:"expression-list-item__code",children:[r.jsx(H,{className:"expression-list-item__value",placeholder:"Expression",maxRows:9,disabled:c,value:e?.value,displayDiff:e?._diff?.fields?.value?.status==="modified",previousValue:e?._diff?.fields?.value?.previousValue,onChange:l=>g({value:l}),variableType:n,onFocus:()=>s(!0),onBlur:()=>s(!1),noStyle:!0}),r.jsx(ae,{expression:e})]}),r.jsxs("div",{className:"expression-list-item__action",children:[r.jsx(J,{iconOnly:!0,disabled:!m||c,onConfirm:N}),i&&r.jsx(se,{id:e.id,value:e.value})]})]})},se=k.memo(({id:e,value:a})=>{const{inputData:n,initial:i}=x(({debug:s})=>{const t=(s?.snapshot?.expressions??[]).find(o=>o.id===e),u=t?.key?s?.trace.traceData[t.key]:void 0;return{inputData:s?.inputData,initial:t&&u?{expression:t.value,result:ie(u.result)}:void 0}});return r.jsx("div",{className:"expression-list-item__livePreview",children:r.jsx(X,{expression:a,inputData:n,initial:i})})}),ae=({expression:e})=>{const{trace:a}=x(({debug:n})=>({trace:n?.trace?.traceData?.[e.key]?.result}));return a?r.jsx("div",{className:"expression-list-item__resultOverlay",children:r.jsxs(w.Text,{ellipsis:{tooltip:a},style:{maxWidth:60,overflow:"hidden"},children:["= ",a]})}):null},ie=e=>{try{return JSON.parse(e)}catch(a){return a.toString()}};I.__docgenInfo={description:"",methods:[],displayName:"ExpressionItem",props:{expression:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  id: string;
  key: string;
  value: string;
  _diff?: DiffMetadata;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"key",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}},{key:"_diff",value:{name:"signature",type:"object",raw:`{
  status?: DiffStatus;
  previousValue?: T;
  previousIndex?: number;
  currentIndex?: number;
  fields?: Record<string, DiffMetadata>;
}`,signature:{properties:[{key:"status",value:{name:"union",raw:"'added' | 'removed' | 'modified' | 'unchanged' | 'moved'",elements:[{name:"literal",value:"'added'"},{name:"literal",value:"'removed'"},{name:"literal",value:"'modified'"},{name:"literal",value:"'unchanged'"},{name:"literal",value:"'moved'"}],required:!1}},{key:"previousValue",value:{name:"T",required:!1}},{key:"previousIndex",value:{name:"number",required:!1}},{key:"currentIndex",value:{name:"number",required:!1}},{key:"fields",value:{name:"Record",elements:[{name:"string"},{name:"DiffMetadata"}],raw:"Record<string, DiffMetadata>",required:!1}}]},required:!1}}]}},description:""},index:{required:!0,tsType:{name:"number"},description:""},variableType:{required:!1,tsType:{name:"VariableType"},description:""}}};const S=({})=>{const{expressions:e,addRowBelow:a,configurable:n,disabled:i,inputVariableType:s}=x(({expressions:o,addRowBelow:p,configurable:c,disabled:m,inputVariableType:g})=>({expressions:o,addRowBelow:p,configurable:c,disabled:m,inputVariableType:g}),y),[t,u]=d.useState();return d.useEffect(()=>{if(!R()||!s)return;const o=s.clone();e.filter(p=>p.key.length>0).forEach(p=>{const c=o.calculateType(p.value);o.set(`$.${p.key}`,c)}),u(o)},[e,s]),r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"expression-list",children:[r.jsxs("div",{className:D("expression-list__item","expression-list__item--heading"),children:[r.jsx("div",{className:"expression-list__item__th expression-list__item__th--order"}),r.jsx(w.Text,{type:"secondary",className:"expression-list__item__th expression-list__item__th--key",children:"Key"}),r.jsx(w.Text,{type:"secondary",className:"expression-list__item__th",children:"Expression"}),r.jsx("div",{})]}),(e||[]).map((o,p)=>r.jsx(I,{expression:o,index:p,variableType:t},o.id))]}),n&&!i&&r.jsx("div",{className:"expression-list__button-wrapper",children:r.jsx(Y,{className:"expression-list__button",icon:r.jsx(K,{}),type:"link",onClick:()=>a(),children:"Add row"})})]})};S.__docgenInfo={description:"",methods:[],displayName:"ExpressionList"};const ne=({manager:e,debug:a,inputData:n,...i})=>{const[s,t]=d.useState(!1),u=d.useRef(null);d.useEffect(()=>{t(!0)},[]);const o=d.useMemo(()=>e?{manager:e}:{backend:U,options:{rootElement:u.current}},[u.current,e]);return r.jsx("div",{ref:u,children:u.current&&r.jsx(W,{...o,children:r.jsxs(E,{children:[r.jsx(re,{...i}),r.jsx(S,{}),r.jsx(te,{debug:a,inputData:n})]})})})},te=({debug:e,inputData:a})=>{const n=T();return d.useEffect(()=>{const i=n.getState();y(i,e)||n.setState({debug:e})},[e]),d.useEffect(()=>{R()&&n.setState({inputVariableType:G(a)})},[a]),null};ne.__docgenInfo={description:"",methods:[],displayName:"Expression",props:{manager:{required:!1,tsType:{name:"DragDropManager"},description:""},debug:{required:!1,tsType:{name:"signature",raw:"ExpressionStore['debug']"},description:""},inputData:{required:!1,tsType:{name:"unknown"},description:""},configurable:{required:!1,tsType:{name:"boolean"},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:""},defaultValue:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  key: string;
  value: string;
  _diff?: DiffMetadata;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"key",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}},{key:"_diff",value:{name:"signature",type:"object",raw:`{
  status?: DiffStatus;
  previousValue?: T;
  previousIndex?: number;
  currentIndex?: number;
  fields?: Record<string, DiffMetadata>;
}`,signature:{properties:[{key:"status",value:{name:"union",raw:"'added' | 'removed' | 'modified' | 'unchanged' | 'moved'",elements:[{name:"literal",value:"'added'"},{name:"literal",value:"'removed'"},{name:"literal",value:"'modified'"},{name:"literal",value:"'unchanged'"},{name:"literal",value:"'moved'"}],required:!1}},{key:"previousValue",value:{name:"T",required:!1}},{key:"previousIndex",value:{name:"number",required:!1}},{key:"currentIndex",value:{name:"number",required:!1}},{key:"fields",value:{name:"Record",elements:[{name:"string"},{name:"DiffMetadata"}],raw:"Record<string, DiffMetadata>",required:!1}}]},required:!1}}]}}],raw:"ExpressionEntry[]"},description:""},value:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  key: string;
  value: string;
  _diff?: DiffMetadata;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"key",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}},{key:"_diff",value:{name:"signature",type:"object",raw:`{
  status?: DiffStatus;
  previousValue?: T;
  previousIndex?: number;
  currentIndex?: number;
  fields?: Record<string, DiffMetadata>;
}`,signature:{properties:[{key:"status",value:{name:"union",raw:"'added' | 'removed' | 'modified' | 'unchanged' | 'moved'",elements:[{name:"literal",value:"'added'"},{name:"literal",value:"'removed'"},{name:"literal",value:"'modified'"},{name:"literal",value:"'unchanged'"},{name:"literal",value:"'moved'"}],required:!1}},{key:"previousValue",value:{name:"T",required:!1}},{key:"previousIndex",value:{name:"number",required:!1}},{key:"currentIndex",value:{name:"number",required:!1}},{key:"fields",value:{name:"Record",elements:[{name:"string"},{name:"DiffMetadata"}],raw:"Record<string, DiffMetadata>",required:!1}}]},required:!1}}]}}],raw:"ExpressionEntry[]"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: ExpressionEntry[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  key: string;
  value: string;
  _diff?: DiffMetadata;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"key",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}},{key:"_diff",value:{name:"signature",type:"object",raw:`{
  status?: DiffStatus;
  previousValue?: T;
  previousIndex?: number;
  currentIndex?: number;
  fields?: Record<string, DiffMetadata>;
}`,signature:{properties:[{key:"status",value:{name:"union",raw:"'added' | 'removed' | 'modified' | 'unchanged' | 'moved'",elements:[{name:"literal",value:"'added'"},{name:"literal",value:"'removed'"},{name:"literal",value:"'modified'"},{name:"literal",value:"'unchanged'"},{name:"literal",value:"'moved'"}],required:!1}},{key:"previousValue",value:{name:"T",required:!1}},{key:"previousIndex",value:{name:"number",required:!1}},{key:"currentIndex",value:{name:"number",required:!1}},{key:"fields",value:{name:"Record",elements:[{name:"string"},{name:"DiffMetadata"}],raw:"Record<string, DiffMetadata>",required:!1}}]},required:!1}}]}}],raw:"ExpressionEntry[]"},name:"value"}],return:{name:"void"}}},description:""}}};export{ne as E};
