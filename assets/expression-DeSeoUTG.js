import{j as s}from"./index-CQHSiloJ.js";import{a as K,b as y,p as x,d as j,S as U,f as I,u as G,g as Q,D as X,h as Y,i as Z,j as ee,R as re,H as se,k as ae}from"./confirm-action-B4Xt2y-v.js";import{r as d,R as k}from"./index-DQDNmYQF.js";import{z as w,N as h,T as _,i as M,V as te,e as S}from"./wasm-CFqRl8NK.js";import{c as ne,b as V,a as ie}from"./ce-preview-DdMNMeAE.js";import{D as oe,B as le}from"./AntdIcon-CF93AVgx.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],de=ne("grip-vertical",ue),D=k.createContext({}),N=(e={})=>({id:crypto.randomUUID(),key:"",value:"",...e}),C=({children:e})=>{const a=d.useMemo(()=>K(i=>({configurable:!0,disabled:!1,debugIndex:0,addRowAbove:(t=0)=>{i(x(r=>(r.expressions.splice(t,0,N()),r)))},addRowBelow:t=>{i(x(r=>(t=t??r.expressions.length-1,r.expressions.splice(t+1,0,N()),r)))},expressions:[],setExpressions:t=>{i({expressions:t})},swapRows:(t,r)=>{i(x(n=>{const[l]=n.expressions.splice(t,1);return n.expressions.splice(r,0,l),n}))},removeRow:t=>{i(x(r=>(r.expressions.splice(t,1),r)))},updateRow:(t,r)=>{i(x(n=>(n.expressions[t]={...n.expressions[t],...r},n)))}})),[]);return s.jsx(D.Provider,{value:a,children:e})};function v(e,a=y){return k.useContext(D)(e,a)}const q=()=>k.useContext(D);C.__docgenInfo={description:"",methods:[],displayName:"ExpressionStoreProvider"};const A=()=>{const e=q(),{debugIndex:a,traceCount:i}=e(({debug:r,debugIndex:n})=>({debugIndex:n,traceCount:w(r?.trace?.traceData).with(h.array(),l=>l.length).otherwise(()=>null)})),t=d.useMemo(()=>i?Array.from({length:i}).map((r,n)=>({label:String(n),value:n})):null,[a,i]);return t?s.jsxs(j,{horizontal:!0,horizontalAlign:"space-between",verticalAlign:"center",className:"grl-dt__command-bar",children:[s.jsx(j,{gap:8,horizontal:!0,className:"full-width"}),t&&s.jsxs(j,{horizontal:!0,verticalAlign:"center",horizontalAlign:"end",children:[s.jsx(_.Text,{style:{fontSize:12},children:"Simulation index:"}),s.jsx(U,{size:"small",style:{fontSize:12,minWidth:60},options:t,onChange:r=>e.setState({debugIndex:r}),value:t.some(r=>r.value===a)?a:0})]})]}):null};A.__docgenInfo={description:"",methods:[],displayName:"ExpressionCommandBar"};const ce=({value:e,onChange:a,defaultValue:i=[],configurable:t=!0,disabled:r=!1})=>{const n=d.useRef(!1),l=q(),{setExpressions:o,expressions:p}=v(({setExpressions:c,expressions:m})=>({setExpressions:c,expressions:m}));return d.useEffect(()=>{l.setState({configurable:t,disabled:r})},[t,r]),d.useEffect(()=>{if(a)return l.subscribe((c,m)=>{y(c.expressions,m.expressions)||a?.(c.expressions)})},[l,a]),d.useEffect(()=>{n.current&&e&&!y(e,p)&&o(e)},[e]),d.useEffect(()=>{e?o(e):i&&o(i),n.current=!0},[]),null},B=(e,a)=>w(e).with(h.array(),i=>{const t=i,r=w(a).with(h.number.between(0,t.length-1),n=>n).otherwise(()=>0);return t[r]}).otherwise(i=>i),R=({index:e,children:a})=>{const{addRowAbove:i,addRowBelow:t,disabled:r}=v(({addRowBelow:n,addRowAbove:l,disabled:o})=>({addRowBelow:n,addRowAbove:l,disabled:o}));return s.jsx(oe,{destroyPopupOnHide:!0,transitionName:"",disabled:r,overlayStyle:{minWidth:200},trigger:["contextMenu"],menu:{items:[{key:"addRowAbove",label:s.jsx(I,{left:"Add row above"}),onClick:()=>{i(e)}},{key:"addRowBelow",label:s.jsx(I,{left:"Add row below"}),onClick:()=>{t(e)}}]},children:a})};R.__docgenInfo={description:"",methods:[],displayName:"ExpressionItemContextMenu",props:{index:{required:!0,tsType:{name:"number"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const z=({expression:e,index:a,variableType:i})=>{const[t,r]=d.useState(!1),n=d.useRef(null),{updateRow:l,removeRow:o,swapRows:p,disabled:c,configurable:m}=v(({updateRow:u,removeRow:f,swapRows:b,disabled:H,configurable:J})=>({updateRow:u,removeRow:f,swapRows:b,disabled:H,configurable:J})),g=u=>{l(a,u)},O=()=>{o(a)},[{isDropping:E,direction:T},P]=G({accept:"row",collect:u=>({isDropping:u.isOver({shallow:!0}),direction:(u.getDifferenceFromInitialOffset()?.y||0)>0?"down":"up"}),drop:u=>{p(u.index,a)}}),[{isDragging:L},W,F]=Q({canDrag:m&&!c,item:()=>({...e,index:a}),type:"row",collect:u=>({isDragging:u.isDragging()})});return F(P(n)),s.jsxs("div",{ref:n,className:V("expression-list-item","expression-list__item",E&&T==="down"&&"dropping-down",E&&T==="up"&&"dropping-up",e?._diff?.status&&`expression-list__item--${e?._diff?.status}`),style:{opacity:L?.5:1},children:[s.jsx("div",{ref:W,className:"expression-list-item__drag","aria-disabled":!m||c,children:s.jsx("div",{className:"expression-list-item__drag__inner",children:e?._diff?.status?s.jsx(X,{status:e?._diff?.status,style:{fontSize:16}}):s.jsx(de,{size:10})})}),s.jsx("div",{className:"expression-list-item__key",onClick:u=>{if(u.target instanceof HTMLTextAreaElement)return;const f=u.currentTarget.querySelector("textarea");if(!f)return;f.focus();const b=f.value.length;f.setSelectionRange(b,b)},children:s.jsx(R,{index:a,children:s.jsx(Y,{noStyle:!0,placeholder:"Key",maxRows:10,readOnly:!m||c,displayDiff:e?._diff?.fields?.key?.status==="modified",previousValue:e?._diff?.fields?.key?.previousValue,value:e?.key,onChange:u=>g({key:u.target.value}),autoComplete:"off"})})}),s.jsx("div",{className:"expression-list-item__code",children:s.jsx(R,{index:a,children:s.jsxs("div",{children:[s.jsx(Z,{className:"expression-list-item__value",placeholder:"Expression",maxRows:9,disabled:c,value:e?.value,displayDiff:e?._diff?.fields?.value?.status==="modified",previousValue:e?._diff?.fields?.value?.previousValue,onChange:u=>g({value:u}),variableType:i,onFocus:()=>r(!0),onBlur:()=>r(!1),noStyle:!0}),s.jsx(me,{expression:e})]})})}),s.jsxs("div",{className:"expression-list-item__action",children:[s.jsx(ee,{iconOnly:!0,disabled:!m||c,onConfirm:O}),t&&s.jsx(pe,{id:e.id,value:e.value})]})]})},pe=k.memo(({id:e,value:a})=>{const{inputData:i,initial:t}=v(({debug:r,debugIndex:n,calculatedInputData:l})=>{const o=(r?.snapshot?.expressions??[]).find(c=>c.id===e),p=o?.key?B(r?.trace.traceData,n)?.[o.key]:void 0;return{inputData:l,initial:o&&p?{expression:o.value,result:fe(p.result)}:void 0}});return s.jsx("div",{className:"expression-list-item__livePreview",children:s.jsx(ie,{expression:a,inputData:i,initial:t})})}),me=({expression:e})=>{const{trace:a}=v(({debug:i,debugIndex:t})=>({trace:B(i?.trace?.traceData,t)?.[e.key]?.result}));return a?s.jsx("div",{className:"expression-list-item__resultOverlay",children:s.jsxs(_.Text,{ellipsis:{tooltip:a},style:{maxWidth:60,overflow:"hidden"},children:["= ",a]})}):null},fe=e=>{try{return JSON.parse(e)}catch(a){return a.toString()}};z.__docgenInfo={description:"",methods:[],displayName:"ExpressionItem",props:{expression:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  id: string;
  key: string;
  value: string;
  _diff?: DiffMetadata;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"key",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}},{key:"_diff",value:{name:"signature",type:"object",raw:`{
  status?: DiffStatus;
  previousValue?: T;
  previousIndex?: number;
  currentIndex?: number;
  fields?: Record<string, DiffMetadata>;
}`,signature:{properties:[{key:"status",value:{name:"union",raw:"'added' | 'removed' | 'modified' | 'unchanged' | 'moved'",elements:[{name:"literal",value:"'added'"},{name:"literal",value:"'removed'"},{name:"literal",value:"'modified'"},{name:"literal",value:"'unchanged'"},{name:"literal",value:"'moved'"}],required:!1}},{key:"previousValue",value:{name:"T",required:!1}},{key:"previousIndex",value:{name:"number",required:!1}},{key:"currentIndex",value:{name:"number",required:!1}},{key:"fields",value:{name:"Record",elements:[{name:"string"},{name:"DiffMetadata"}],raw:"Record<string, DiffMetadata>",required:!1}}]},required:!1}}]}},description:""},index:{required:!0,tsType:{name:"number"},description:""},variableType:{required:!1,tsType:{name:"VariableType"},description:""}}};const $=({})=>{const{expressions:e,addRowBelow:a,configurable:i,disabled:t,inputVariableType:r}=v(({expressions:o,addRowBelow:p,configurable:c,disabled:m,inputVariableType:g})=>({expressions:o,addRowBelow:p,configurable:c,disabled:m,inputVariableType:g}),y),[n,l]=d.useState();return d.useEffect(()=>{if(!M()||!r)return;const o=r.clone();e.filter(p=>p.key.length>0).forEach(p=>{const c=o.calculateType(p.value);o.set(`$.${p.key}`,c)}),l(o)},[e,r]),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"expression-list",children:[s.jsxs("div",{className:V("expression-list__item","expression-list__item--heading"),children:[s.jsx("div",{className:"expression-list__item__th expression-list__item__th--order"}),s.jsx(_.Text,{type:"secondary",className:"expression-list__item__th expression-list__item__th--key",children:"Key"}),s.jsx(_.Text,{type:"secondary",className:"expression-list__item__th",children:"Expression"}),s.jsx("div",{})]}),(e||[]).map((o,p)=>s.jsx(z,{expression:o,index:p,variableType:n},o.id))]}),i&&!t&&s.jsx("div",{className:"expression-list__button-wrapper",children:s.jsx(le,{className:"expression-list__button",icon:s.jsx(re,{}),type:"link",onClick:()=>a(),children:"Add row"})})]})};$.__docgenInfo={description:"",methods:[],displayName:"ExpressionList"};const ve=({manager:e,debug:a,hideCommandBar:i,...t})=>{const[r,n]=d.useState(!1),l=d.useRef(null);d.useEffect(()=>{n(!0)},[]);const o=d.useMemo(()=>e?{manager:e}:{backend:se,options:{rootElement:l.current}},[l.current,e]);return s.jsx("div",{ref:l,children:l.current&&s.jsx(ae,{...o,children:s.jsxs(C,{children:[s.jsx(ce,{...t}),!i&&s.jsx(A,{}),s.jsx($,{}),s.jsx(xe,{debug:a})]})})})},xe=({debug:e})=>{const a=q();return d.useEffect(()=>{const i=a.getState();y(i.debug,e)||a.setState({debug:e})},[e]),d.useEffect(()=>{if(!M())return;const i=r=>w(r.debug?.trace.traceData).with(h.array(),()=>!0).otherwise(()=>!1),t=r=>{const n=r.debug?.inputData;if(!n)return;const l=new te(n.data);if(i(r)){let o=l.get(r.debugIndex).cloneWith("$nodes",n.$nodes);n.$&&(o=o.cloneWith("$",n.$)),a.setState({calculatedInputData:o,inputVariableType:S.fromVariable(o)})}else{let o=l.cloneWith("$nodes",n.$nodes);n.$&&(o=o.cloneWith("$",n.$)),a.setState({calculatedInputData:o,inputVariableType:S.fromVariable(o)})}};return t(a.getState()),a.subscribe((r,n)=>{r.debugIndex===n.debugIndex&&r.debug===n.debug||t(r)})},[]),null};ve.__docgenInfo={description:"",methods:[],displayName:"Expression",props:{manager:{required:!1,tsType:{name:"DragDropManager"},description:""},debug:{required:!1,tsType:{name:"signature",raw:"ExpressionStore['debug']"},description:""},hideCommandBar:{required:!1,tsType:{name:"boolean"},description:""},configurable:{required:!1,tsType:{name:"boolean"},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:""},defaultValue:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  key: string;
  value: string;
  _diff?: DiffMetadata;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"key",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}},{key:"_diff",value:{name:"signature",type:"object",raw:`{
  status?: DiffStatus;
  previousValue?: T;
  previousIndex?: number;
  currentIndex?: number;
  fields?: Record<string, DiffMetadata>;
}`,signature:{properties:[{key:"status",value:{name:"union",raw:"'added' | 'removed' | 'modified' | 'unchanged' | 'moved'",elements:[{name:"literal",value:"'added'"},{name:"literal",value:"'removed'"},{name:"literal",value:"'modified'"},{name:"literal",value:"'unchanged'"},{name:"literal",value:"'moved'"}],required:!1}},{key:"previousValue",value:{name:"T",required:!1}},{key:"previousIndex",value:{name:"number",required:!1}},{key:"currentIndex",value:{name:"number",required:!1}},{key:"fields",value:{name:"Record",elements:[{name:"string"},{name:"DiffMetadata"}],raw:"Record<string, DiffMetadata>",required:!1}}]},required:!1}}]}}],raw:"ExpressionEntry[]"},description:""},value:{required:!1,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  key: string;
  value: string;
  _diff?: DiffMetadata;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"key",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}},{key:"_diff",value:{name:"signature",type:"object",raw:`{
  status?: DiffStatus;
  previousValue?: T;
  previousIndex?: number;
  currentIndex?: number;
  fields?: Record<string, DiffMetadata>;
}`,signature:{properties:[{key:"status",value:{name:"union",raw:"'added' | 'removed' | 'modified' | 'unchanged' | 'moved'",elements:[{name:"literal",value:"'added'"},{name:"literal",value:"'removed'"},{name:"literal",value:"'modified'"},{name:"literal",value:"'unchanged'"},{name:"literal",value:"'moved'"}],required:!1}},{key:"previousValue",value:{name:"T",required:!1}},{key:"previousIndex",value:{name:"number",required:!1}},{key:"currentIndex",value:{name:"number",required:!1}},{key:"fields",value:{name:"Record",elements:[{name:"string"},{name:"DiffMetadata"}],raw:"Record<string, DiffMetadata>",required:!1}}]},required:!1}}]}}],raw:"ExpressionEntry[]"},description:""},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: ExpressionEntry[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  id: string;
  key: string;
  value: string;
  _diff?: DiffMetadata;
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"key",value:{name:"string",required:!0}},{key:"value",value:{name:"string",required:!0}},{key:"_diff",value:{name:"signature",type:"object",raw:`{
  status?: DiffStatus;
  previousValue?: T;
  previousIndex?: number;
  currentIndex?: number;
  fields?: Record<string, DiffMetadata>;
}`,signature:{properties:[{key:"status",value:{name:"union",raw:"'added' | 'removed' | 'modified' | 'unchanged' | 'moved'",elements:[{name:"literal",value:"'added'"},{name:"literal",value:"'removed'"},{name:"literal",value:"'modified'"},{name:"literal",value:"'unchanged'"},{name:"literal",value:"'moved'"}],required:!1}},{key:"previousValue",value:{name:"T",required:!1}},{key:"previousIndex",value:{name:"number",required:!1}},{key:"currentIndex",value:{name:"number",required:!1}},{key:"fields",value:{name:"Record",elements:[{name:"string"},{name:"DiffMetadata"}],raw:"Record<string, DiffMetadata>",required:!1}}]},required:!1}}]}}],raw:"ExpressionEntry[]"},name:"value"}],return:{name:"void"}}},description:""}}};export{ve as E};
